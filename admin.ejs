<%- include('partials/navbar') %>
<main class="py-20 px-6 max-w-7xl mx-auto space-y-12">
    <h2 class="text-5xl font-black italic uppercase tracking-tighter text-white">ADMIN <span class="text-blue-500">DASHBOARD</span></h2>
   
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="glass p-8 rounded-[30px] space-y-8">
            <form action="/admin/live" method="POST" class="space-y-4">
                <h3 class="text-xs font-bold uppercase opacity-40 tracking-widest text-white">Live Stream Link</h3>
                <input name="link" value="<%= liveLink %>" placeholder="YouTube Link" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl text-white outline-none">
                <button type="submit" class="w-full bg-blue-600 py-4 rounded-2xl font-bold uppercase text-xs text-white">Update Live</button>
            </form>

            <form action="/admin/add-match" method="POST" class="space-y-4 text-white">
                <h3 class="text-xs font-bold uppercase opacity-40 tracking-widest text-white">Schedule Match</h3>
                <div class="grid grid-cols-2 gap-4">
                    <input name="teamA" placeholder="Team 1" class="bg-white/5 border border-white/10 p-4 rounded-2xl outline-none text-xs">
                    <input name="logoA" placeholder="Logo 1 URL" class="bg-white/5 border border-white/10 p-4 rounded-2xl outline-none text-xs">
                    <input name="teamB" placeholder="Team 2" class="bg-white/5 border border-white/10 p-4 rounded-2xl outline-none text-xs">
                    <input name="logoB" placeholder="Logo 2 URL" class="bg-white/5 border border-white/10 p-4 rounded-2xl outline-none text-xs">
                </div>
                <input name="time" placeholder="Match Time (e.g. 18:00)" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none">
                <button type="submit" class="w-full bg-white text-black py-4 rounded-2xl font-bold uppercase text-xs">Post Match</button>
            </form>
        </div>

        <div class="glass p-8 rounded-[30px]">
            <h3 class="text-xs font-bold uppercase opacity-40 tracking-widest mb-6 text-white">Market Players</h3>
            <div class="space-y-4 max-h-[400px] overflow-y-auto pr-2">
                <% players.forEach(p => { %>
                    <div class="flex justify-between items-center bg-white/5 p-4 rounded-2xl text-white">
                        <span class="font-bold text-sm uppercase"><%= p.name %></span>
                        <form action="/admin/delete-player" method="POST">
                            <input type="hidden" name="playerId" value="<%= p.id %>">
                            <button type="submit" class="text-red-500 font-bold text-[10px] uppercase">Remove</button>
                        </form>
                    </div>
                <% }) %>
            </div>
        </div>
    </div>

    <div class="glass p-10 rounded-[30px] space-y-10">
        <div class="flex justify-between items-center border-b border-white/5 pb-6">
            <h3 class="text-xs font-bold uppercase opacity-40 tracking-widest text-white text-blue-500">League Tables & Rosters</h3>
            <form action="/admin/add-group" method="POST" class="flex gap-2">
                <input name="name" placeholder="New Table Name" class="bg-white/5 border border-white/10 px-4 py-2 rounded-xl text-xs text-white">
                <button type="submit" class="bg-blue-600 px-4 py-2 rounded-xl text-[10px] font-bold uppercase text-white">Create Table</button>
            </form>
        </div>

        <% groups.forEach(group => { %>
            <div class="space-y-8 p-6 border border-white/5 rounded-[40px] bg-white/[0.02]">
                <div class="flex justify-between items-center">
                    <h4 class="text-blue-500 font-black italic uppercase text-xl"><%= group.name %></h4>
                    <form action="/admin/delete-group" method="POST">
                        <input type="hidden" name="groupId" value="<%= group.id %>">
                        <button type="submit" class="text-red-500 text-[9px] font-bold border border-red-500/30 px-3 py-1 rounded-full uppercase">Delete Whole Table</button>
                    </form>
                </div>

                <div class="grid grid-cols-1 gap-6">
                    <% group.teams.forEach((team, index) => { %>
                        <div class="bg-white/5 p-6 rounded-3xl border border-white/5 space-y-6">
                            <form action="/admin/update-team" method="POST" class="grid grid-cols-2 md:grid-cols-7 gap-3 items-center text-white">
                                <input type="hidden" name="groupId" value="<%= group.id %>">
                                <input type="hidden" name="teamIndex" value="<%= index %>">
                                <div class="flex items-center gap-2 px-2">
                                    <img src="<%= team.logo %>" class="w-5 h-5 object-contain">
                                    <span class="font-bold text-xs truncate w-24"><%= team.name %></span>
                                </div>
                                <div class="flex flex-col text-[8px] opacity-40">MP<input name="mp" type="number" value="<%= team.mp || 0 %>" class="bg-black/40 rounded p-1 text-white text-center border-none"></div>
                                <div class="flex flex-col text-[8px] opacity-40">W<input name="wins" type="number" value="<%= team.wins || 0 %>" class="bg-black/40 rounded p-1 text-white text-center border-none"></div>
                                <div class="flex flex-col text-[8px] opacity-40">L<input name="loses" type="number" value="<%= team.loses || 0 %>" class="bg-black/40 rounded p-1 text-white text-center border-none"></div>
                                <div class="flex flex-col text-[8px] opacity-40 text-blue-400">PTS<input name="pts" type="number" value="<%= team.pts || 0 %>" class="bg-black/40 rounded p-1 text-blue-400 text-center border-none"></div>
                                <button type="submit" class="bg-blue-600 py-2 rounded-xl text-[8px] font-bold uppercase">Update Stats</button>
                                <button type="submit" formaction="/admin/delete-team" class="bg-red-500/10 text-red-500 py-2 rounded-xl text-[8px] font-bold uppercase">Delete Team</button>
                            </form>

                            <div class="bg-black/20 p-4 rounded-2xl space-y-4">
                                <p class="text-[9px] font-black uppercase tracking-widest opacity-30">Team Roster</p>
                                <div class="flex flex-wrap gap-2">
                                    <% (team.roster || []).forEach((player, pIdx) => { %>
                                        <div class="bg-white/5 px-3 py-1.5 rounded-full flex items-center gap-2 border border-white/5">
                                            <span class="text-[10px] uppercase <%= player.isManager ? 'text-blue-400 font-black' : 'text-white' %>">
                                                <%= player.isManager ? 'MGR:' : '' %> <%= player.name %>
                                            </span>
                                            <form action="/admin/delete-from-roster" method="POST">
                                                <input type="hidden" name="groupId" value="<%= group.id %>">
                                                <input type="hidden" name="teamIndex" value="<%= index %>">
                                                <input type="hidden" name="playerIndex" value="<%= pIdx %>">
                                                <button type="submit" class="text-red-500 font-bold hover:scale-125 transition">×</button>
                                            </form>
                                        </div>
                                    <% }) %>
                                </div>
                                <form action="/admin/add-to-roster" method="POST" class="flex gap-2">
                                    <input type="hidden" name="groupId" value="<%= group.id %>">
                                    <input type="hidden" name="teamIndex" value="<%= index %>">
                                    <input name="playerName" required placeholder="Player Name" class="bg-black/40 p-2 rounded-xl text-[10px] flex-1 text-white outline-none">
                                    <select name="isManager" class="bg-black/40 p-2 rounded-xl text-[10px] text-white outline-none">
                                        <option value="false">Player</option>
                                        <option value="true">Manager</option>
                                    </select>
                                    <button type="submit" class="bg-white/10 px-4 rounded-xl text-[9px] font-black uppercase text-white hover:bg-white/20 transition">Add To Squad</button>
                                </form>
                            </div>
                        </div>
                    <% }) %>
                   
                    <form action="/admin/update-team" method="POST" class="grid grid-cols-3 gap-2 p-6 border border-dashed border-white/10 rounded-3xl">
                        <input type="hidden" name="groupId" value="<%= group.id %>">
                        <input name="teamName" placeholder="Team Name" class="bg-white/5 p-3 rounded-xl text-xs text-white outline-none">
                        <input name="logo" placeholder="Logo URL" class="bg-white/5 p-3 rounded-xl text-xs text-white outline-none">
                        <button type="submit" class="bg-white/10 text-white text-[10px] font-bold uppercase rounded-xl">Add New Team</button>
                    </form>
                </div>
            </div>
        <% }) %>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-white">
        <% ['scorers', 'saves', 'assists'].forEach(type => { %>
            <div class="glass p-8 rounded-[30px] space-y-6">
                <h3 class="text-xs font-bold uppercase opacity-40 tracking-widest text-blue-400">TOP <%= type.toUpperCase() %></h3>
                <div class="space-y-3">
                    <% (leaderboards[type] || []).forEach((player, idx) => { %>
                        <form action="/admin/update-stat" method="POST" class="flex gap-2 items-center bg-white/5 p-2 rounded-xl">
                            <input type="hidden" name="type" value="<%= type %>">
                            <input type="hidden" name="statIndex" value="<%= idx %>">
                            <span class="text-[10px] font-bold flex-1 uppercase"><%= player.name %></span>
                            <input name="value" type="number" value="<%= player.value %>" class="w-12 bg-black/40 text-center rounded text-xs p-1 border-none text-white">
                            <button type="submit" class="bg-blue-600 px-2 py-1 rounded text-[8px]">✓</button>
                            <button type="submit" formaction="/admin/delete-stat" class="text-red-500 text-[10px] font-black">×</button>
                        </form>
                    <% }) %>
                </div>
                <form action="/admin/update-stat" method="POST" class="space-y-2 pt-4 border-t border-white/5">
                    <input type="hidden" name="type" value="<%= type %>">
                    <input name="playerName" required placeholder="Player Name" class="w-full bg-white/5 p-3 rounded-xl text-[10px] text-white outline-none">
                    <input name="value" type="number" required placeholder="Count" class="w-full bg-white/5 p-3 rounded-xl text-[10px] text-white outline-none">
                    <button type="submit" class="w-full bg-blue-600 py-3 rounded-xl text-[10px] font-bold uppercase">Add New Entry</button>
                </form>
            </div>
        <% }) %>
    </div>

    <div class="glass p-10 rounded-[30px] space-y-10 border border-blue-500/20">
        <div class="flex justify-between items-center border-b border-white/5 pb-6">
            <h3 class="text-xs font-bold uppercase opacity-40 tracking-widest text-white text-blue-500">League Records / Hall of Fame</h3>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <form action="/admin/add-record" method="POST" class="space-y-4">
                <h3 class="text-[10px] font-black uppercase opacity-30 tracking-widest text-white">Add Achievement</h3>
                <div class="grid grid-cols-2 gap-4">
                    <input name="title" required placeholder="Achievement Title" class="bg-white/5 border border-white/10 p-4 rounded-2xl text-xs text-white outline-none">
                    <input name="holder" required placeholder="Holder Name" class="bg-white/5 border border-white/10 p-4 rounded-2xl text-xs text-white outline-none">
                </div>
                <textarea name="description" placeholder="Short description..." class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl text-xs text-white outline-none h-24"></textarea>
                <button type="submit" class="w-full bg-blue-600 py-4 rounded-2xl font-black uppercase text-xs text-white">Etch Record</button>
            </form>

            <div class="space-y-4">
                <h3 class="text-[10px] font-black uppercase opacity-30 tracking-widest text-white">Current Records</h3>
                <div class="space-y-3 max-h-[350px] overflow-y-auto pr-2">
                    <% (records || []).forEach(record => { %>
                        <div class="flex justify-between items-center bg-white/5 p-5 rounded-2xl border border-white/5 text-white">
                            <div>
                                <p class="text-xs font-black uppercase italic"><%= record.title %></p>
                                <p class="text-[10px] text-blue-500 font-bold uppercase"><%= record.holder %></p>
                            </div>
                            <form action="/admin/delete-record" method="POST">
                                <input type="hidden" name="recordId" value="<%= record.id %>">
                                <button type="submit" class="text-red-500 font-black text-[10px] border border-red-500/20 px-3 py-1 rounded-full hover:bg-red-500/10 transition">DELETE</button>
                            </form>
                        </div>
                    <% }) %>
                </div>
            </div>
        </div>
    </div>

    <div class="glass p-10 rounded-[40px] border border-white/5 mb-12">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-black italic uppercase text-blue-500">Registered Market Database</h2>
            <input type="text" id="playerSearch" onkeyup="filterPlayers()" placeholder="SEARCH PLAYER..." 
            class="bg-white/5 border border-white/10 px-4 py-2 rounded-xl text-[10px] text-white outline-none w-1/3 focus:border-blue-500">
        </div>
       
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="bg-red-500/10 border border-red-500 text-red-500 p-4 rounded-xl mb-6 font-bold uppercase text-xs tracking-widest">
                <%= error %>
            </div>
        <% } %>

        <div class="space-y-4" id="playerList">
            <% players.forEach(player => { %>
                <details class="player-card group bg-white/[0.02] border border-white/5 rounded-3xl overflow-hidden" data-name="<%= player.name.toLowerCase() %>">
                    <summary class="p-6 cursor-pointer flex justify-between items-center hover:bg-white/[0.05] transition-all list-none">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-blue-600/20 rounded-full flex items-center justify-center font-black italic text-blue-500">
                                <%= player.name.charAt(0) %>
                            </div>
                            <div>
                                <p class="font-black uppercase italic tracking-tight text-white"><%= player.name %></p>
                                <p class="text-[10px] opacity-30 font-bold uppercase tracking-widest text-white"><%= player.discord %></p>
                            </div>
                        </div>
                        <span class="text-blue-500 group-open:rotate-180 transition-transform font-black">↓</span>
                    </summary>
                   
                    <div class="p-8 border-t border-white/5 bg-black/20 text-white">
                        <form action="/admin/update-market-player" method="POST" class="space-y-6">
                            <input type="hidden" name="username" value="<%= player.name %>">
                           
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                <div>
                                    <label class="text-[10px] uppercase font-black opacity-40 mb-2 block tracking-widest">Goals</label>
                                    <input type="number" name="goals" value="<%= player.goals %>" class="w-full bg-black border border-white/10 rounded-xl p-3 text-sm focus:border-blue-500 outline-none text-white">
                                </div>
                                <div>
                                    <label class="text-[10px] uppercase font-black opacity-40 mb-2 block tracking-widest">Assists</label>
                                    <input type="number" name="assists" value="<%= player.assists %>" class="w-full bg-black border border-white/10 rounded-xl p-3 text-sm focus:border-blue-500 outline-none text-white">
                                </div>
                                <div>
                                    <label class="text-[10px] uppercase font-black opacity-40 mb-2 block tracking-widest">Saves</label>
                                    <input type="number" name="saves" value="<%= player.saves %>" class="w-full bg-black border border-white/10 rounded-xl p-3 text-sm focus:border-blue-500 outline-none text-white">
                                </div>
                                <div>
                                    <label class="text-[10px] uppercase font-black text-blue-400 mb-2 block tracking-widest">MVPs</label>
                                    <input type="number" name="mvps" value="<%= player.mvps || 0 %>" class="w-full bg-black border border-blue-500/30 rounded-xl p-3 text-sm focus:border-blue-500 outline-none text-white">
                                </div>
                            </div>

                            <div>
                                <label class="text-[10px] uppercase font-black opacity-40 mb-2 block tracking-widest">Bio Content</label>
                                <textarea name="bio" rows="3" class="w-full bg-black border border-white/10 rounded-xl p-4 text-sm focus:border-blue-500 outline-none text-white"><%= player.experience || player.bio %></textarea>
                            </div>

                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black uppercase text-[10px] tracking-[0.3em] transition-all text-white">Update Database Entry</button>
                        </form>
                    </div>
                </details>
            <% }) %>
        </div>
    </div>
</main>

<script>
    function filterPlayers() {
        let input = document.getElementById('playerSearch').value.toLowerCase();
        let cards = document.getElementsByClassName('player-card');
        for (let i = 0; i < cards.length; i++) {
            let name = cards[i].getAttribute('data-name');
            cards[i].style.display = name.includes(input) ? "" : "none";
        }
    }
</script>